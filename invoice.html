{% extends "base.html" %}
{% block content %}
<h2>Create Invoice</h2>
<form method="POST">
    <div class="mb-3">
        <label>Customer</label>
        <select name="customer_id" class="form-select" required>
            <option value="">Select Customer</option>
            {% for customer in customers %}
                <option value="{{ customer.id }}">{{ customer.name }}</option>
            {% endfor %}
        </select>
    </div>

    <h4>Items</h4>
    <div id="items">
        <div class="row g-3 mb-2">
            <div class="col-md-5">
                <select name="product_id[]" class="form-select" required>
                    <option value="">Select Product</option>
                    {% for product in products %}
                        <option value="{{ product.id }}">{{ product.name }} - ${{ product.price }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-3">
                <input type="number" name="quantity[]" class="form-control" placeholder="Quantity" required>
            </div>
            <div class="col-md-2">
                <button type="button" class="btn btn-danger remove-item">Remove</button>
            </div>
        </div>
    </div>
    <button type="button" class="btn btn-secondary mb-3" id="addItem">Add Item</button>

    <div class="mb-3">
        <label>Tax</label>
        <input type="number" step="0.01" name="tax" class="form-control" value="0">
    </div>

    <div class="mb-3">
        <label>Payment Method</label>
        <select name="payment_method" class="form-select" required>
            <option value="Cash">Cash</option>
            <option value="Online">Online</option>
        </select>
    </div>

    <button type="submit" class="btn btn-primary">Create Invoice</button>
</form>

<script>
document.getElementById('addItem').addEventListener('click', function(){
    let itemRow = document.querySelector('#items .row').cloneNode(true);
    itemRow.querySelector('input').value = '';
    document.getElementById('items').appendChild(itemRow);
});

document.addEventListener('click', function(e){
    if(e.target.classList.contains('remove-item')){
        let rows = document.querySelectorAll('#items .row');
        if(rows.length > 1) e.target.closest('.row').remove();
    }
});
</script>
{% endblock %}
